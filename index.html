<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modern M3U IPTV Player</title>
  <style>
    :root{
      --bg:#0b0f14; --muted:#9aa4b2; --accent:#1db954; --glass: rgba(255,255,255,0.12); --text:#e6eef6;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    body{margin:0;background:#000;color:var(--text);}
    *{box-sizing:border-box}

    #playerWrap{position:fixed; inset:0; background:#000; display:flex; align-items:center; justify-content:center}
    #videoContainer{width:100%; height:100%; position:relative; background:#000}
    video{width:100%; height:100%; display:block; object-fit:contain}

    /* overlay current channel */
    .overlay{position:absolute; left:14px; top:14px; display:flex; gap:12px; align-items:center; background:linear-gradient(90deg, rgba(0,0,0,0.45), rgba(0,0,0,0.25)); padding:10px 12px; border-radius:8px}
    .overlay .logo{width:56px; height:36px; background:rgba(255,255,255,0.1); border-radius:6px; display:flex; align-items:center; justify-content:center; overflow:hidden}
    .overlay .logo img{width:100%; height:100%; object-fit:contain}
    .current-info .title{font-weight:700}
    .current-info .num{color:var(--accent); font-size:14px}

    /* side list overlay */
    #sideList{
      position:absolute; top:0; left:0; width:320px; height:100%;
      background:rgba(12,16,22,0.85);
      box-shadow:4px 0 30px rgba(0,0,0,0.6); overflow-y:auto; padding:12px;
      transform:translateX(-100%); transition:transform .25s ease;
      z-index:50;
    }
    #sideList.open{ transform:translateX(0); }

    #sideList .side-item {
      all: unset;
      display: flex;
      gap: 10px;
      align-items: center;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      color: var(--text);
      margin-bottom: 8px;
    }
    #sideList .side-item.active { background: rgba(29,185,84,0.2); }
    #sideList .side-item .logo {
      width: 56px; height: 34px; flex: 0 0 56px;
      background: rgba(255,255,255,0.1); border-radius: 6px;
      display:flex; align-items:center; justify-content:center; overflow:hidden;
    }
    #sideList .side-item .logo img {width:100%; height:100%; object-fit:contain;}
    #sideList .side-item .ch-name { font-size:14px; color:#e7eef9; }
    #sideList .side-item .ch-number { font-weight:700; color:var(--accent); margin-right:6px; }

    /* number & volume OSD */
    #numOSD, #volOSD {
      position:absolute;
      top:50%; left:50%;
      transform:translate(-50%,-50%);
      font-size:64px; font-weight:700; color:#fff;
      background:rgba(0,0,0,0.6);
      padding:20px 40px;
      border-radius:12px;
      display:none;
      z-index:100;
    }
    #volOSD { font-size:24px; width:260px; padding:14px; }
    #volOSD .bar {height:12px; background:rgba(255,255,255,0.2); border-radius:6px; overflow:hidden}
    #volOSD .fill {height:100%; background:var(--accent); width:50%}

    /* custom controls */
    #controlsBar {
      position:absolute; bottom:0; left:0; right:0;
      background:rgba(0,0,0,0.6);
      padding:8px 12px;
      display:flex; align-items:center; gap:12px;
      z-index:60;
    }
    #controlsBar button {
      background:none; border:none; cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      padding:6px; border-radius:6px;
      color:white;
    }
    #controlsBar button svg {
      width:22px; height:22px; fill:white;
    }
    #progress {flex:1;}
    #volume {width:100px;}
  </style>
</head>
<body>
  <div id="playerWrap">
    <div id="videoContainer">
      <video id="player" playsinline></video>

      <div class="overlay">
        <div class="logo"><img id="curLogo" src="" alt="logo"></div>
        <div class="current-info">
          <div class="title" id="curTitle">Channel</div>
          <div class="num" id="curNumber">#0</div>
        </div>
      </div>

      <!-- Side channel list -->
      <div id="sideList"></div>

      <!-- Number OSD -->
      <div id="numOSD"></div>
      <!-- Volume OSD -->
      <div id="volOSD"><div class="bar"><div class="fill"></div></div></div>

      <!-- Custom controls -->
      <div id="controlsBar">
        <button id="playPause">
          <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </button>
        <input id="progress" type="range" min="0" max="100" value="0">
        <button id="muteBtn">
          <svg id="volIcon" viewBox="0 0 24 24"><path d="M5 9v6h4l5 5V4l-5 5H5z"/></svg>
        </button>
        <input id="volume" type="range" min="0" max="1" step="0.05" value="1">
        <button id="fsBtn">
          <svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm0-4h2V7h3V5H7v5zm10 9h-3v2h5v-5h-2v3zm-3-14v2h3v3h2V5h-5z"/></svg>
        </button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.0/dist/hls.min.js"></script>
  <script>
    let channels = [], curIndex=-1, hls=null;
    const player=document.getElementById('player');
    const curTitle=document.getElementById('curTitle');
    const curNumber=document.getElementById('curNumber');
    const curLogo=document.getElementById('curLogo');
    const sideList=document.getElementById('sideList');
    const numOSD=document.getElementById('numOSD');
    const volOSD=document.getElementById('volOSD');
    const volFill=volOSD.querySelector('.fill');
    const playPause=document.getElementById('playPause');
    const muteBtn=document.getElementById('muteBtn');
    const volIcon=document.getElementById('volIcon');
    const fsBtn=document.getElementById('fsBtn');
    const progress=document.getElementById('progress');
    const volume=document.getElementById('volume');

    function parseM3U(text){
      channels=[]; let lines=text.split(/\r?\n/), lastMeta='', num=1;
      for(const raw of lines){
        const line=(raw||'').trim(); if(!line) continue;
        if(line.startsWith('#EXTINF')) lastMeta=line;
        else if(!line.startsWith('#')){
          let url=line, title=url.split('/').pop()||('Channel '+num), logo='';
          if(lastMeta){
            const comma=lastMeta.indexOf(',');
            if(comma>-1) title=lastMeta.slice(comma+1).trim();
            const m=lastMeta.match(/tvg-logo\s*=\s*"([^"]+)"/i);
            if(m) logo=m[1];
          }
          channels.push({num,title,url,logo}); num++; lastMeta='';
        }
      }
    }

    function renderSideList(){
      sideList.innerHTML='';
      channels.forEach((ch,idx)=>{
        const btn=document.createElement('button');
        btn.className='side-item'; btn.dataset.index=idx;
        btn.innerHTML=`<div class="logo"><img src="${ch.logo||''}" onerror="this.style.opacity=.25"></div>
          <div><span class="ch-number">${ch.num}</span> <span class="ch-name">${ch.title}</span></div>`;
        btn.onclick=()=>{openChannel(idx); hideSideList();};
        sideList.appendChild(btn);
      });
    }

    function loadStream(url){
      if(hls){try{hls.destroy();}catch(e){} hls=null;}
      if(player.canPlayType('application/vnd.apple.mpegurl')) player.src=url;
      else if(window.Hls&&Hls.isSupported()){hls=new Hls();hls.loadSource(url);hls.attachMedia(player);}
      else player.src=url;
      player.play().catch(()=>{});
    }

    function openChannel(i){
      if(i<0||i>=channels.length) return;
      curIndex=i; let ch=channels[i];
      curTitle.textContent=ch.title; curNumber.textContent='#'+ch.num; curLogo.src=ch.logo||'';
      loadStream(ch.url); hideNumOSD();
    }

    function showSideList(){renderSideList();sideList.classList.add('open');}
    function hideSideList(){sideList.classList.remove('open');}

    // Number OSD
    let numBuffer="", numTimeout=null;
    function showNumOSD(){numOSD.textContent=numBuffer; numOSD.style.display="block";}
    function hideNumOSD(){numBuffer=""; numOSD.style.display="none";}
    function handleNumberInput(d){
      numBuffer+=d; showNumOSD();
      if(numTimeout) clearTimeout(numTimeout);
      numTimeout=setTimeout(()=>jumpToChannel(),2000);
    }
    function jumpToChannel(){
      if(!numBuffer) return;
      const n=parseInt(numBuffer,10);
      const idx=channels.findIndex(c=>c.num===n);
      if(idx!==-1) openChannel(idx);
      hideNumOSD();
    }

    // Volume OSD
    function showVolume(){
      let v=Math.round(player.volume*100);
      volFill.style.width=v+'%';
      volOSD.style.display="block";
      clearTimeout(volOSD._t);
      volOSD._t=setTimeout(()=>volOSD.style.display="none",1000);
    }

    // keyboard
    window.addEventListener('keydown',e=>{
      if(!channels.length) return;
      if(e.key>='0'&&e.key<='9'){e.preventDefault();handleNumberInput(e.key);}
      else if(e.key==='Enter'&&numBuffer){e.preventDefault();jumpToChannel();}
      else if(e.key==='ArrowUp'){e.preventDefault();player.volume=Math.min(1,player.volume+0.1);showVolume();}
      else if(e.key==='ArrowDown'){e.preventDefault();player.volume=Math.max(0,player.volume-0.1);showVolume();}
      else if(e.key==='ArrowLeft'){e.preventDefault();showSideList();}
      else if(e.key==='ArrowRight'){e.preventDefault();hideSideList();}
    });

    // controls
    playPause.onclick=()=>{if(player.paused){player.play();}else{player.pause();}};
    player.onplay=()=>playPause.innerHTML='<svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
    player.onpause=()=>playPause.innerHTML='<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';
    muteBtn.onclick=()=>{player.muted=!player.muted; volIcon.innerHTML=player.muted?'<path d="M16.5 12l4.5 4.5-1.5 1.5L15 13.5l-4.5 4.5H7v-12h3.5L15 10.5l4.5-4.5 1.5 1.5L16.5 12z"/>':'<path d="M5 9v6h4l5 5V4l-5 5H5z"/>';};
    volume.oninput=()=>{player.volume=volume.value; showVolume();}
    player.ontimeupdate=()=>{if(!progress.dragging) progress.value=(player.currentTime/player.duration||0)*100;}
    progress.oninput=()=>{progress.dragging=true;}
    progress.onchange=()=>{player.currentTime=player.duration*(progress.value/100); progress.dragging=false;}
    fsBtn.onclick=()=>{if(!document.fullscreenElement) videoContainer.requestFullscreen(); else document.exitFullscreen();};

    // Auto load tv.m3u
    async function autoLoadPlaylist(){
      try{
        const res=await fetch("tv.m3u"); if(!res.ok) throw 0;
        const text=await res.text(); parseM3U(text);
        if(channels.length) openChannel(0);
      }catch(e){console.log("tv.m3u not found");}
    }
    autoLoadPlaylist();
  </script>
</body>
</html>
